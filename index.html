<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Assegnazione Tavoli - Evento BCC</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {font-family: Arial, sans-serif; text-align: center; background:#f5f5f5; margin:0; padding:0;}
    h1 {margin-top:40px;}
    .card {margin:30px auto; padding:20px 25px; background:white; border-radius:10px; max-width:400px; border:1px solid #ccc;}
    .input-group {margin-bottom:12px; text-align:left;}
    .input-group label {display:block; font-size:0.9rem; margin-bottom:4px;}
    .input-group input {width:100%; padding:8px; border-radius:4px; border:1px solid #bbb;}
    button {padding:10px 18px; border-radius:4px; border:1px solid #333; cursor:pointer; background:#eee;}
    #message {margin-top:20px; font-size:1.1rem; font-weight:bold;}
    #error {margin-top:10px; color:red;}
  </style>
</head>

<body>

<h1>Assegnazione Tavoli - Evento BCC</h1>

<div class="card">
  <h2>Benvenuto!</h2>

  <form id="assignForm">
    <div class="input-group">
      <label>Nome</label>
      <input id="name" type="text" placeholder="Inserisci il tuo nome" required>
    </div>

    <div class="input-group">
      <label>Filiale o Ufficio</label>
      <input id="office" type="text" placeholder="Inserisci nome filiale o ufficio" required>
    </div>

    <button type="submit">Ottieni il tuo tavolo</button>
    <div id="error"></div>
  </form>

  <div id="message"></div>
</div>

<script>
  const TOTAL_TABLES = 30;
  const SEATS_PER_TABLE = 8;

  function loadOcc() {
    const saved = localStorage.getItem("bcc_occ_v1");
    if (saved) {
      try {
        const arr = JSON.parse(saved);
        if (Array.isArray(arr) && arr.length === TOTAL_TABLES) return arr;
      } catch {}
    }
    const arr = Array(TOTAL_TABLES).fill(0);
    localStorage.setItem("bcc_occ_v1", JSON.stringify(arr));
    return arr;
  }

  function saveOcc(arr) {
    localStorage.setItem("bcc_occ_v1", JSON.stringify(arr));
  }

  let occ = loadOcc();

  document.getElementById("assignForm").addEventListener("submit", function(e){
    e.preventDefault();

    const name = document.getElementById("name").value.trim();
    const office = document.getElementById("office").value.trim();
    const errorDiv = document.getElementById("error");
    const messageDiv = document.getElementById("message");

    errorDiv.textContent = "";
    messageDiv.textContent = "";

    if (!name || !office) {
      errorDiv.textContent = "Inserisci tutti i campi.";
      return;
    }

    const key = "assign_" + name.toLowerCase() + "_" + office.toLowerCase();
    let assigned = localStorage.getItem(key);
    let tableNumber;

    if (assigned) {
      tableNumber = parseInt(assigned);
    } else {
      const next = occ.findIndex(v => v < SEATS_PER_TABLE);
      if (next === -1) {
        messageDiv.textContent = "Tutti i tavoli sono pieni. Grazie!";
        return;
      }
      occ[next] += 1;
      saveOcc(occ);
      tableNumber = next + 1;
      localStorage.setItem(key, tableNumber);
    }

    const seatsNow = occ[tableNumber - 1];

    let result = `${name}, della filiale/ufficio ${office}, il tuo tavolo è: Tavolo ${tableNumber}.`;

    if (seatsNow === SEATS_PER_TABLE) {
      result += ` Il tavolo ${tableNumber} è pronto per festeggiare!`;
    }

    messageDiv.textContent = result;
  });
</script>

</body>
</html>
