<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Evento BCC - Stelle Oro</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: radial-gradient(circle at top, #e0f4ff, #f2f2f2 55%, #e8f5e9);
  display:flex;
  justify-content:center;
  padding-top:40px;
}

/* CARD CON BORDO ORO */
.container {
  background:white;
  padding:30px;
  border-radius:20px;
  border:4px solid gold;
  box-shadow:0 0 25px rgba(255,215,0,0.6);
  width:520px;
  max-width:95vw;
}

.logo {
  display:block;
  max-width:260px;
  margin:0 auto 12px;
}

h1 {
  text-align:center;
  color:#004f71;
  margin-bottom:20px;
}

.field { margin-bottom:14px; }
label { font-weight:600; margin-bottom:4px; display:block; }

input[type=text] {
  width:100%;
  padding:10px;
  border-radius:6px;
  border:1px solid #ccc;
}

#assignBtn {
  width:100%;
  padding:12px;
  border:none;
  border-radius:999px;
  background:linear-gradient(90deg,#009739,#006699);
  color:white;
  font-weight:bold;
  cursor:pointer;
}

/* RISULTATO */
.result {
  margin-top:18px;
  text-align:center;
  font-size:18px;
  color:#004f71;
}
.result .welcome { font-size:18px; display:block; }
.result .table-label { margin-top:4px; display:block; }

.result .table-number {
  font-size:40px;
  background:linear-gradient(120deg,#009739,#006699);
  color:white;
  padding:10px 22px;
  border-radius:999px;
  display:inline-block;
  margin-top:6px;
  position:relative;
  z-index:2;
}

/* GLOW DIETRO NUMERO */
.result .table-number::before {
  content:"";
  position:absolute;
  top:-12px; left:-12px; right:-12px; bottom:-12px;
  background: radial-gradient(circle, rgba(255,223,0,0.55), rgba(255,223,0,0));
  border-radius:50%;
  filter: blur(12px);
  animation: glowPulse 2.4s infinite ease-in-out;
  z-index:-1;
}

@keyframes glowPulse {
  0% { opacity:0.3; transform:scale(0.9); }
  50% { opacity:1; transform:scale(1.15); }
  100% { opacity:0.3; transform:scale(0.9); }
}

/* NEVE A STELLA ORO */
#snow-container {
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  pointer-events:none;
  z-index:999;
}

.snowflake {
  position:absolute;
  font-size:38px;
  color:#FFD700;
  text-shadow:
     0 0 12px #FFD700,
     0 0 26px #FFD700,
     0 0 40px rgba(255,215,0,0.9),
     0 0 55px rgba(255,215,0,0.9);
  animation:snowFall 10s linear forwards;
  opacity:0.98;
}

@keyframes snowFall {
  0% { transform: translateY(-150px) rotate(0deg) scale(1); opacity:1; }
  100% { transform: translateY(130vh) rotate(360deg) scale(1.6); opacity:0; }
}

/* DASHBOARD ORGANIZZATORE */
.dashboard {
  margin-top:28px;
  padding-top:18px;
  border-top:2px dashed #ffd700;
  display:none; /* nascosta di default */
}

.dashboard-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
}

.dashboard h2 {
  font-size:20px;
  margin:0;
  color:#004f71;
  text-align:left;
}

.reset-btn {
  padding:4px 8px;
  font-size:12px;
  border-radius:999px;
  border:none;
  background:#888;
  color:white;
  cursor:pointer;
}

.dashboard-summary {
  font-size:14px;
  margin:10px 0 12px;
}

.dashboard-summary span {
  font-weight:bold;
}

.tables-grid {
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap:10px;
}

.table-card {
  border:1px solid #ddd;
  border-radius:10px;
  padding:8px 10px;
  font-size:14px;
  background:#fafafa;
}

.table-title {
  font-weight:bold;
  margin-bottom:4px;
  color:#004f71;
}

.table-info {
  margin-bottom:6px;
}

.progress-bar {
  width:100%;
  height:8px;
  border-radius:999px;
  background:#eee;
  overflow:hidden;
  margin-bottom:6px;
}

.progress-fill {
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#009739,#006699);
  transition:width 0.25s ease;
}

/* elenco persone al tavolo */
.people-list {
  margin:4px 0 6px;
  padding-left:16px;
  font-size:12px;
  max-height:80px;
  overflow:auto;
}

.people-list li {
  margin-bottom:2px;
}

.people-empty {
  font-size:12px;
  color:#777;
  margin-bottom:6px;
}

.minus-btn {
  width:100%;
  padding:4px 6px;
  border-radius:999px;
  border:none;
  cursor:pointer;
  font-size:12px;
  background:#f44336;
  color:white;
}

.minus-btn:disabled {
  opacity:0.45;
  cursor:default;
}

/* Pulsante per aprire area organizzatori */
.admin-btn {
  position:fixed;
  right:10px;
  bottom:10px;
  padding:6px 10px;
  font-size:11px;
  border-radius:999px;
  border:none;
  background:#004f71;
  color:white;
  opacity:0.6;
  z-index:1000;
}
</style>
</head>

<body>

<div id="snow-container"></div>

<div class="container">
  <img src="logo.jpg" class="logo" alt="Logo BCC Magna Grecia">
  <h1>Benvenuto all'evento BCC Magna Grecia</h1>

  <div id="result" class="result"></div>

  <div class="field">
    <label>Nome</label>
    <input id="nameInput" type="text">
  </div>

  <div class="field">
    <label>Ufficio / Filiale</label>
    <input id="officeInput" type="text">
  </div>

  <button id="assignBtn">Scopri il tuo tavolo</button>

  <audio id="bellSound" src="campane.mp3" preload="auto"></audio>

  <!-- DASHBOARD ORGANIZZATORE (inizialmente nascosta) -->
  <div class="dashboard" id="dashboard">
    <div class="dashboard-header">
      <h2>Dashboard tavoli</h2>
      <button id="resetBtn" class="reset-btn">Azzera tavoli</button>
    </div>
    <div class="dashboard-summary">
      Posti totali: <span id="totalSeats"></span> —
      Occupati: <span id="occupiedSeats"></span> —
      Liberi: <span id="freeSeats"></span>
    </div>
    <div id="tablesGrid" class="tables-grid"></div>
  </div>
</div>

<!-- piccolo bottone fisso per area organizzatori -->
<button id="showAdminBtn" class="admin-btn">Area organizzatori</button>

<script>
const TABLE_COUNT = 10;
const TABLE_CAPACITY = 8;
const TOTAL_SEATS = TABLE_COUNT * TABLE_CAPACITY;

// aggiungo anche l'elenco persone per tavolo
const tables = Array.from(
  {length:TABLE_COUNT},
  (_,i)=>({id:i+1, used:0, people:[]})
);

const result = document.getElementById("result");
const nameInput = document.getElementById("nameInput");
const officeInput = document.getElementById("officeInput");
const bellSound = document.getElementById("bellSound");
const snowContainer = document.getElementById("snow-container");

// elementi dashboard
const totalSeatsEl = document.getElementById("totalSeats");
const occupiedSeatsEl = document.getElementById("occupiedSeats");
const freeSeatsEl = document.getElementById("freeSeats");
const tablesGrid = document.getElementById("tablesGrid");
const dashboardEl = document.getElementById("dashboard");
const resetBtn = document.getElementById("resetBtn");

totalSeatsEl.textContent = TOTAL_SEATS;

function allFull(){ return tables.every(t => t.used >= TABLE_CAPACITY); }

function playBell(){
  try {
    bellSound.volume=1;
    bellSound.currentTime=0;
    bellSound.play();
  } catch(e){}
}

function launchSnow(){
  for(let i=0;i<60;i++){
    const s=document.createElement("div");
    s.classList.add("snowflake");
    s.textContent = "✧";   // STELLA ORO
    s.style.left = Math.random()*100 + "vw";
    s.style.animationDelay = (Math.random()*3) + "s";
    s.style.fontSize = (34 + Math.random()*20) + "px";
    snowContainer.appendChild(s);
    setTimeout(()=>s.remove(),11000);
  }
}

// aggiorna dashboard (riempimento tavoli + contatori + persone)
function renderDashboard(){
  const occupied = tables.reduce((sum,t)=>sum + t.used, 0);
  const free = TOTAL_SEATS - occupied;
  occupiedSeatsEl.textContent = occupied;
  freeSeatsEl.textContent = free;

  tablesGrid.innerHTML = "";
  tables.forEach(t => {
    const card = document.createElement("div");
    card.className = "table-card";

    const perc = (t.used / TABLE_CAPACITY) * 100;

    const peopleLines = t.people
      .map(p => `<li>${p.name} (${p.office})</li>`)
      .join("");

    const peopleHtml = t.people.length
      ? `<ul class="people-list">${peopleLines}</ul>`
      : `<div class="people-empty">Nessuno ancora.</div>`;

    card.innerHTML = `
      <div class="table-title">Tavolo ${t.id}</div>
      <div class="table-info">${t.used} / ${TABLE_CAPACITY} posti</div>
      <div class="progress-bar">
        <div class="progress-fill" style="width:${perc}%;"></div>
      </div>
      ${peopleHtml}
      <button class="minus-btn" data-table-id="${t.id}" ${t.used === 0 ? "disabled" : ""}>-1 posto</button>
    `;

    tablesGrid.appendChild(card);
  });
}

// click -1 posto (event delegation sulla griglia)
tablesGrid.addEventListener("click", (e) => {
  if (!e.target.classList.contains("minus-btn")) return;

  const id = parseInt(e.target.getAttribute("data-table-id"), 10);
  const table = tables.find(t => t.id === id);
  if (!table) return;

  if (table.used > 0) {
    table.used--;
    if (table.people.length > 0) {
      table.people.pop(); // rimuove l'ultima persona seduta a quel tavolo
    }
    renderDashboard();
  }
});

document.getElementById("assignBtn").onclick = ()=>{
  const name=nameInput.value.trim();
  const office=officeInput.value.trim();

  if(!name || !office){
    result.textContent="Inserisci Nome e Ufficio/Filiale.";
    return;
  }

  if(allFull()){
    result.textContent="Tutti i tavoli sono pieni (80 posti).";
    return;
  }

  const avail = tables.filter(t => t.used < TABLE_CAPACITY);
  const chosen = avail[Math.floor(Math.random()*avail.length)];
  chosen.used++;
  chosen.people.push({name, office});

  result.innerHTML =
    "<span class='welcome'><strong>"+name+
    "</strong> ("+office+")</span>" +
    "<span class='table-label'>Il tuo tavolo è il</span>" +
    "<span class='table-number'>"+chosen.id+"</span>";

  playBell();
  launchSnow();

  nameInput.value="";
  officeInput.value="";
  nameInput.focus();

  renderDashboard();
};

// inizializza dashboard alla partenza
renderDashboard();

/* Pulsante Area organizzatori con codice 1109 */
document.getElementById("showAdminBtn").addEventListener("click", () => {
  const code = prompt("Codice organizzatore:");
  if (code === "1109") {
    dashboardEl.style.display =
      dashboardEl.style.display === "none" || dashboardEl.style.display === "" 
      ? "block" 
      : "none";
  } else if (code !== null) {
    alert("Codice errato");
  }
});

/* Bottone AZZERA TAVOLI */
resetBtn.addEventListener("click", () => {
  if (!confirm("Sei sicura di voler azzerare tutti i tavoli?")) return;
  tables.forEach(t => {
    t.used = 0;
    t.people = [];
  });
  result.textContent = "";
  renderDashboard();
});
</script>

</body>
</html>
